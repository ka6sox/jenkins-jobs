make update 2>&1
cd shr-core
. ./setup-env
export MACHINE=qemuarm
LOGDIR=log.world.`date "+%Y%m%d_%H%M%S"`.log
mkdir ${LOGDIR}
rm -rf tmp-eglibc/*;
mkdir tmp-eglibc || echo "tmp-eglibc already exists"
mount | grep "tmp-eglibc type tmpfs" && echo "Some tmp-eglibc already has tmpfs mounted, skipping mount" || mount tmp-eglibc
#for T in gcc core-image-sato qt4-x11-free qt4-embedded webkit-gtk webkit-efl shr-image-all world world-image; do 
for T in world; do 
  time bitbake -k ${T} | tee -a ${LOGDIR}/bitbake.${T}.log || break; 
done | tee ${LOGDIR}/bitbake.log; 
cat tmp-eglibc/qa.log >> ${LOGDIR}/qa.log || echo "No QA issues"; 

cp conf/world* ${LOGDIR}
rsync -avir ${LOGDIR} jenkins@logs.nslu2-linux.org:htdocs/buildlogs/oe/oe-shr-core-branches
cat ${LOGDIR}/qa.log && true

# wait for pseudo
sleep 180
umount tmp-eglibc || echo "Umounting tmp-eglibc failed"
rm -rf tmp-eglibc/*;
